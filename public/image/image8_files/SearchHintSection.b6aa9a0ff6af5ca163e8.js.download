(("undefined"!=typeof self?self:this).webpackJsonp=("undefined"!=typeof self?self:this).webpackJsonp||[]).push([[249],{1520:function(e,t,r){"use strict";var a=r(120),n=r(0),c=r.n(n);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var o=function(e){return c.a.createElement("svg",i({enableBackground:"new 0 0 15 15",viewBox:"0 0 15 15",x:"0",y:"0",strokeWidth:"0"},e),c.a.createElement("path",{d:"m13 1.9c-.2-.5-.8-1-1.4-1h-8.4c-.6.1-1.2.5-1.4 1l-1.4 4.3c0 .8.3 1.6.9 2.1v4.8c0 .6.5 1 1.1 1h10.2c.6 0 1.1-.5 1.1-1v-4.6c.6-.4.9-1.2.9-2.3zm-11.4 3.4 1-3c .1-.2.4-.4.6-.4h8.3c.3 0 .5.2.6.4l1 3zm .6 3.5h.4c.7 0 1.4-.3 1.8-.8.4.5.9.8 1.5.8.7 0 1.3-.5 1.5-.8.2.3.8.8 1.5.8.6 0 1.1-.3 1.5-.8.4.5 1.1.8 1.7.8h.4v3.9c0 .1 0 .2-.1.3s-.2.1-.3.1h-9.5c-.1 0-.2 0-.3-.1s-.1-.2-.1-.3zm8.8-1.7h-1v .1s0 .3-.2.6c-.2.1-.5.2-.9.2-.3 0-.6-.1-.8-.3-.2-.3-.2-.6-.2-.6v-.1h-1v .1s0 .3-.2.5c-.2.3-.5.4-.8.4-1 0-1-.8-1-.8h-1c0 .8-.7.8-1.3.8s-1.1-1-1.2-1.7h12.1c0 .2-.1.9-.5 1.4-.2.2-.5.3-.8.3-1.2 0-1.2-.8-1.2-.9z"}))};t.a=Object(a.a)({Icon:o})},1572:function(e,t,r){"use strict";r.d(t,"a",function(){return c});var a=r(142),n=r(184);function c(e){void 0===e&&(e="unknown");var t=Object(n.b)();return function(r){t({type:"action",timestamp:Date.now(),info:{action:e,operation:e,data:Object(a.c)(r||{})}})}}},1701:function(e,t,r){"use strict";r.d(t,"a",function(){return n}),r.d(t,"d",function(){return c}),r.d(t,"b",function(){return i}),r.d(t,"c",function(){return o}),r.d(t,"e",function(){return s});var a=r(1),n=Object(a.b)("FETCH_BFF_SEARCH_HINT"),c={PRODUCT:0,USER:1},i={MATCH_SHOP:1,MATCH_CATEGORY:2,MATCH_COLLECTION:3,MATCH_SHOP_CATE:5,MATCH_KEYWORD:6},o={REGULAR:0,CURATED_SEARCH:1},s={DEFAULT:1,CURATED_SEARCH:2}},1839:function(e,t,r){"use strict";r.d(t,"c",function(){return c}),r.d(t,"b",function(){return o}),r.d(t,"a",function(){return s}),r.d(t,"d",function(){return l});var a=r(1881),n=r(8);function c(e,t){var r=t.searchParams,c=t.isOfficialMall,i=Object(a.b)(r,c);return e&&e[i]?e[i].progress:n.b.INIT}var i=[];function o(e,t){var r=t.searchParams,n=t.isOfficialMall,c=Object(a.b)(r,n);return e&&e[c]&&e[c].data?e[c].data.keywords:i}function s(e,t){var r=t.searchParams,n=t.isOfficialMall,c=Object(a.b)(r,n);return e&&e[c]&&e[c].data?e[c].data.algorithm:null}function l(e,t){var r=t.searchParams,n=t.isOfficialMall,c=Object(a.b)(r,n);return e&&e[c]&&e[c].data?e[c].data.trackingid:null}},1881:function(e,t,r){"use strict";r.d(t,"a",function(){return s}),r.d(t,"b",function(){return l}),r.d(t,"c",function(){return u});var a=r(15),n=r(5),c=r(1701);function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}function o(e,t){if(null==e)return{};var r,a,n={},c=Object.keys(e);for(a=0;a<c.length;a++)r=c[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}function s(e,t,r){var n,i={keyword:e.keyword,search_type:c.d.PRODUCT,version:r?c.e.CURATED_SEARCH:c.e.DEFAULT},o={},s=c.b.MATCH_KEYWORD;return e.collection?(s=c.b.MATCH_COLLECTION,n=e.collection):e.category&&(s=c.b.MATCH_CATEGORY,n=e.subcategory||e.category,i.catid=n),n&&(o.match=[{type:s,value:n}]),t&&(o.official=1),Object.keys(o).length>0&&(i.match_value=JSON.stringify(o)),Object(a.f)(i)}function l(e,t,r){var n={keyword:e.keyword,version:r?c.e.CURATED_SEARCH:c.e.DEFAULT};return e.collection?n.collection=e.collection:e.category&&(n.category=e.category,e.subcategory&&(n.subcategory=e.subcategory)),t&&(n.isOfficialMall=!0),Object(a.f)(n)}function u(e){var t=e.keywords,r=o(e,["keywords"]),a=t.map(function(e){if(e.record_type===c.c.REGULAR)return e;var t=e.data,r=o(e,["data"]);try{return i({},r,{data:{curated_search_module_meta:{data:JSON.parse(Object(n.a)(t,["curated_search_module_meta","data"],"null"))},curated_search_module_data:{data:JSON.parse(Object(n.a)(t,["curated_search_module_data","data"],"null"))}}})}catch(e){return i({},r,{data:{curated_search_module_meta:{data:null},curated_search_module_data:{data:null}}})}});return i({},r,{keywords:a})}},2297:function(e,t,r){"use strict";var a=r(0),n=r(72),c=r(364),i=r(122),o=r(1520),s=r(104),l=r(65),u=r(379),h=r(249);t.a=Object(n.connect)(function(){return{}},{recordSearchHistory:h.b})(Object(u.a)(function(e){var t=e.isOfficialShop,r=e.keyword,n=e.onClick,u=e.trackingRef,h=e.trackingClick,f=e.recordSearchHistory;return a.createElement(c.a,{className:"shopee-searchbar-hints__search-shop",onClick:function(){n(),h(),f(i.j.USER,r||"")},to:Object(s.searchUser)(r),innerRef:u},a.createElement(o.a,null),Object(l.tNode)(t?"label_search_x_in_shopee":"label_search_x_shops",{username:a.createElement("span",{className:"shopee-searchbar-hints__entry__bold-product-name"},r)}))},"SearchMethodShop"))},2298:function(e,t,r){"use strict";var a=r(0),n=r(364),c=r(379),i=r(65);t.a=Object(c.a)(function(e){var t=e.hint,r=e.typedText,c=e.trackingClick,o=e.trackingRef,s=e.onEntryClick,l=e.linkTo,u=t.keyword,h=t.catid,f=t.cat_display_name||"";return a.createElement(n.a,{className:"shopee-searchbar-hints__entry",onClick:function(){s(),c&&c()},to:l},a.createElement("div",{ref:o,className:"shopee-searchbar-hints__entry__product-name"},a.createElement("span",{className:"shopee-searchbar-hints__entry__typed-product-name"},u.slice(0,r.length)),a.createElement("span",null,u.slice(r.length))),!!h&&a.createElement("div",{className:"shopee-searchbar-hints__entry__category-name"},a.createElement("span",null,Object(i.t)("label_in_category",{category:f,interpolation:{escape:!1}}))))},"SearchHint")},2299:function(e,t,r){"use strict";var a=r(0),n=r(364),c=r(379),i=r(910),o=r(104),s=r(297);t.a=Object(c.a)(function(e){var t=e.searchPrefill,r=e.onClick,c=e.trackingRef,l=e.trackingClick,u=a.useCallback(function(){r(),l()},[r,l]);if(!t)return null;var h=a.createElement(a.Fragment,null,a.createElement("span",{className:"shopee-searchbar-hints__text"},t.hint),a.createElement("img",{src:Object(s.a)(t.image),height:"24"}));return t.link?a.createElement(i.a,{to:t.link,_ref:c,onClick:u,className:"shopee-searchbar-hints__search-prefill"},h):a.createElement(n.a,{className:"shopee-searchbar-hints__search-prefill",onClick:u,to:Object(o.searchWithQuery)({searchPrefill:t.id,noCorrection:!0}),innerRef:c},h)},"SearchMethodPrefill")},2364:function(e,t,r){"use strict";var a=r(0),n=r.n(a),c=r(5),i=r(122),o=r(364),s=r(379),l=r(65),u=Object(s.a)(function(e){var t=e.trackingClick,r=e.trackingRef,n=e.typedText,c=e.historyEntry,i=e.onEntryClick,s=e.linkTo,u=c.keyword,h=c.category;return a.createElement(o.a,{className:"shopee-searchbar-hints__history-entry",to:s,onClick:function(){i(),t&&t()},innerRef:r},a.createElement("div",{className:"shopee-searchbar-hints__history-entry__text"},a.createElement("span",{className:"shopee-searchbar-hints__history-entry__typed-text"},n),a.createElement("span",null,u.slice(n.length))),h&&h.id&&a.createElement("div",{className:"shopee-searchbar-hints__history-entry__category-name"},a.createElement("span",null,Object(l.t)("label_in_category",{category:h.name,interpolation:{escape:!1}}))))},"SearchHintHistory"),h=Object(s.a)(function(e){var t=e.trackingClick,r=e.trackingRef,n=e.typedText,c=e.historyEntry,i=e.onEntryClick,s=e.linkTo,u=c.keyword;return a.createElement(o.a,{className:"shopee-searchbar-hints__history-entry",to:s,onClick:function(){i(),t&&t()},innerRef:r},'"',a.createElement("span",{className:"shopee-searchbar-hints__history-entry__typed-text"},n),a.createElement("span",null,u.slice(n.length)),'" '+Object(l.t)("label_shops"))},"SearchShopHintHistory");t.a=function(e){return Object(c.a)(e,["historyEntry","searchType"])===i.j.USER?n.a.createElement(h,e):n.a.createElement(u,e)}},2468:function(e,t,r){e.exports={container:"_1oYG6X",label:"_2i3QSR"}},2469:function(e,t,r){"use strict";var a=r(2523);r.d(t,"fetchSearchHint",function(){return a.a});var n=r(1701);r.d(t,"SEARCH_HINT_RECORD_TYPE",function(){return n.c});var c=r(2470);r.d(t,"searchHintReducer",function(){return c.a});var i=r(1839);r.d(t,"getSearchHintProgress",function(){return i.c}),r.d(t,"getSearchHintKeywords",function(){return i.b}),r.d(t,"getSearchHintAlgorithm",function(){return i.a}),r.d(t,"getSearchHintTrackingId",function(){return i.d});r(2471),r(1881)},2470:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var a,n=r(21),c=r(8),i=r(1701);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var s=Object(n.a)(((a={})[i.a.REQUESTED]=function(e,t){var r,a=t.payload.key,n=e[a]||{};return o({},e,((r={})[a]=o({},n,{progress:c.b.REQ}),r))},a[i.a.SUCCESS]=function(e,t){var r,a=t.payload,n=a.key,i=a.data,s=e[n]||{};return o({},e,((r={})[n]=o({},s,{data:i,progress:c.b.OK}),r))},a[i.a.FAILED]=function(e,t){var r,a=t.payload.key,n=e[a]||{};return o({},e,((r={})[a]=o({},n,{progress:c.b.ERR}),r))},a),{})},2471:function(e,t){},2523:function(e,t,r){"use strict";var a=r(37),n=r(2);var c=r(1881),i=r(1701),o=r(8);function s(e){var t=e.searchParams,r=e.isOfficialMall,o=e.hasCuratedSearch,s=e.getStore,u=e.shouldSkipCall,h=e.onFinish,f=e.onSuccess;if(!t.keyword)return function(){return null};var y=Object(c.a)(t,r,o),d=Object(c.b)(t,r,o);return Object(a.a)({apiCall:function(){return function(e){return Object(n.fetchInfo)("/api/v4/search/search_hint"+e)}(y)},actions:[function(){return{type:i.a.REQUESTED,payload:{key:d}}},function(e,t){return"function"==typeof f&&f(t),{type:i.a.SUCCESS,payload:{key:d,data:Object(c.c)(t)}}},function(){return{type:i.a.FAILED,payload:{key:d}}}],shouldSkipCall:s&&!u?l(d,s):u,onFinish:h})}function l(e,t){return function(r){var a=t(r);return!(!a||!a[e])&&[o.b.OK,o.b.REQ].includes(a[e].progress)}}r.d(t,"a",function(){return s})},3669:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r(72),c=r(2297),i=r(2299),o=r(65),s=r(122),l=r(2468),u=r.n(l);function h(){return(h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var f=function(e){var t=e.inputValue,r=e.isOfficialMall,n=e.hasShopHint,l=e.hasSearchPrefillHint,f=e.searchPrefill,y=e.historyMatches,d=e.onClick,p={relativeLocation:0,absoluteLocation:0};return t?n?a.createElement(c.a,h({},p,{isOfficialShop:r,keyword:t,onClick:function(){d(t,h({},p,{searchType:s.j.USER}))}})):null:l?a.createElement(i.a,h({},p,{searchPrefill:f,onClick:function(){f&&d(f.query,h({},p,{searchType:s.j.PREFILL}))}})):y.length>0?a.createElement("div",{className:u.a.label},Object(o.t)("label_search_history")):a.createElement("div",null)},y=r(2364),d=function(e){var t=e.historyMatches,r=e.searchParams,n=e.inputValue,c=e.hasShopHint,i=e.hasSearchPrefillHint,o=e.onClick,s=e.getLink,l=c||i?1:0;return t.length?t.filter(function(e){return e.keyword}).map(function(e,t){var c=e.keyword,i=e.category,u=e.searchType,h=l+t;return a.createElement(y.a,{index:t,key:c+"-"+t,typedText:n,historyEntry:e,linkTo:s({searchType:u,keyword:c,categoryId:i&&i.id}),onEntryClick:function(){return o(c,{category:i,searchType:u,isHistory:!0,relativeLocation:t,absoluteLocation:h})},searchParams:r,relativeLocation:t,absoluteLocation:h})}):null},p=r(2298),b=r(5),m=r(3),O="searchHint",v=[m.i,m.ec],_=r(2469);function k(e){return e[O]}var g=function(e){var t=e.hints,r=e.firstSearchHistory,n=e.searchParams,c=e.inputValue,i=e.startingIndex,o=e.isLocalSearch,l=e.isHistoryOnly,u=e.onClick,h=e.getLink,f=a.useMemo(function(){return function(e){var t=e.hints,r=e.firstSearchHistory,a=e.isLocalSearch,n=e.startingIndex;return t?t.filter(function(e){if(e.record_type===_.SEARCH_HINT_RECORD_TYPE.CURATED_SEARCH)return!1;var t=e.keyword,n=e.catid||null,c=r||{};return!(t===c.keyword&&n===Object(b.a)(c,["category","id"],null)||n&&a)}).slice(0,s.e-n):null}({hints:t,firstSearchHistory:r,isLocalSearch:o,startingIndex:i})},[r,t,o,i]);return!l&&t&&t.length&&f?f.map(function(e,t){var r=e.keyword,o=e.catid,l=void 0===o?null:o,f=i+t;return a.createElement(p.a,{index:t,key:r+"-"+(l||""),hint:e,typedText:c,onEntryClick:function(){return u(r,{category:l?{id:l,name:e.cat_display_name||""}:void 0,relativeLocation:t,absoluteLocation:f})},linkTo:h({searchType:s.j.PRODUCT,keyword:r,categoryId:l||void 0}),searchParams:n,relativeLocation:t,absoluteLocation:f})}):null},E=r(123),C=r(249),S=r(931),j=r(382),T=r(1572),H=r(241);var P=r(191),R=r(104),L=r(880),w=r(366),M=function(e){var t=e.searchParams,r=e.inputValue,c=e.isLocalSearch,i=e.isOfficialMall,o=e.searchPrefill,l=e.routePath,h=e.onEntryClick,y=Object(n.useDispatch)(),p=function(e){var t=e.dispatch,r=e.searchParams,c=e.isOfficialMall,i=e.routePath,o=a.useContext(H.a).injectAsyncReducer;a.useEffect(function(){var e;o(((e={})[O]=_.searchHintReducer,e))},[o]),a.useEffect(function(){t(Object(_.fetchSearchHint)({searchParams:r,isOfficialMall:c,getStore:k,onSuccess:function(e){t(Object(C.d)(e,c))}}))},[t,c,r]);var s=Object(n.useSelector)(k),l={searchParams:r,isOfficialMall:c};return{progress:Object(_.getSearchHintProgress)(s,l),keywords:Object(_.getSearchHintKeywords)(s,l),algorithm:Object(_.getSearchHintAlgorithm)(s,l),trackingId:Object(_.getSearchHintTrackingId)(s,l),sourcePageType:c?"mall":v.includes(i)?"category":"global"}}({searchParams:t,isOfficialMall:i,routePath:l,dispatch:y}),b=p.keywords,m=p.algorithm,w=p.trackingId,M=p.sourcePageType,A=!r||!!c&&!!(t.collection||t.shop||t.site),I=function(e){var t=e.inputValue,r=e.isLocalSearch,c=e.isOfficialMall,i=e.isHistoryOnly,o=e.searchPrefill,l=Object(n.useSelector)(function(e){return c?Object(S.b)(e):Object(S.a)(e)});return a.useMemo(function(){var e=l.get("timeMachine"),a=[],n=i||r?0:1;return e&&e.size>0&&e.reverse().find(function(e){if(e){var c=e.toJS(),l=c.searchType,u=c.keyword,h=[s.j.USER].includes(l);if(u&&(!r||!h&&!a.some(function(e){return e.keyword===u}))&&(t?!h&&u.startsWith(t):!o||!Object(j.a)(u,o.hint)))return n++,a.push(r?{keyword:u,searchType:s.j.PRODUCT}:c),!i||n>=s.e}return!1}),{historyMatches:a,entryCount:n}},[t,i,r,l,o])}({inputValue:r,isLocalSearch:c,isHistoryOnly:A,isOfficialMall:i,searchPrefill:o}),N=I.historyMatches,U=I.entryCount,D=function(e){var t=e.searchParams,r=e.inputValue,n=e.isOfficialMall,c=e.searchPrefill,i=e.dispatch,o=e.onEntryClick,l=Object(T.a)("submitHintSearch"),u=a.useCallback(function(e,a){var n=a.searchType,i=a.isHistory,o=void 0!==i&&i,s=a.relativeLocation,u=a.absoluteLocation,h=a.isOfficialMall;l({typedText:r,keyword:e,searchType:n,searchParams:t,relativeLocation:s,absoluteLocation:u,isHistory:o,isOfficialMallSearch:h,searchPrefill:c})},[r,t,c,l]);return a.useCallback(function(e,t){var r=t.searchType,a=void 0===r?s.j.PRODUCT:r,c=t.category,l=t.isHistory,h=void 0!==l&&l,f=t.relativeLocation,y=t.absoluteLocation;a!==s.j.PREFILL&&i(n?Object(C.c)(a,e,c):Object(C.b)(a,e,{category:c})),u(e,{searchType:a,isHistory:h,relativeLocation:f,absoluteLocation:y,isOfficialMall:n}),"function"==typeof o&&o(e)},[i,n,o,u])}({searchParams:t,inputValue:r,isOfficialMall:i,searchPrefill:o,dispatch:y,onEntryClick:h}),x=a.useCallback(function(e){var r=e.searchType,a=e.keyword,n=e.categoryId;if(r===s.j.USER)return P.e.getUrl({keyword:a});var o=Object(L.a)(a,t,c,i);return!c&&n&&(o.facet=[n]),w&&(o.trackingId=w),Object(R.searchWithQuery)(o,i)},[c,i,t,w]),F=!!r&&!c,V=!(r||c||i||!o);return a.createElement(E.a,{targetData:{sourcePageType:M,trackingId:w,algorithm:m}},a.createElement("div",{className:u.a.container},a.createElement(f,{inputValue:r,isOfficialMall:i,hasShopHint:F,hasSearchPrefillHint:V,searchPrefill:o,historyMatches:N,onClick:D}),a.createElement(d,{historyMatches:N,searchParams:t,inputValue:r,isLocalSearch:c,isOfficialMall:i,trackingId:w,hasShopHint:F,hasSearchPrefillHint:V,onClick:D,getLink:x}),a.createElement(g,{hints:b,firstSearchHistory:N[0],searchParams:t,inputValue:r,isLocalSearch:c,isHistoryOnly:A,startingIndex:U,onClick:D,getLink:x})))};function A(e,t){return!Object(w.a)(e,t,["inputValue","isLocalSearch","isOfficialMall","searchPrefill","routePath","onEntryClick"],["searchParams"])}t.default=a.memo(M,A)}}]);
//# sourceMappingURL=https://shopee.sg/assets/SearchHintSection.b6aa9a0ff6af5ca163e8.js.map